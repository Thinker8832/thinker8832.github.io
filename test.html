<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Route Animation - National Freeway 1</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// 初始化地圖
var map = L.map('map').setView([25.039167, 121.562722], 9);  // 國道一號某段區域的座標

// 設置地圖圖磚
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
}).addTo(map);

// Overpass API 查詢：國道一號路徑
let query = `
[out:json];
way["highway"="motorway"]["ref"="1"](25.0,120.0,25.5,122.0);
out body;
>;
out skel qt;
`;
let url = `https://overpass-api.de/api/interpreter?data=${encodeURIComponent(query)}`;

// 取得國道一號的路徑
async function fetchRouteData() {
    let response = await fetch(url);
    let data = await response.json();
    let coordinates = [];
    
    // 將 OSM 返回的座標轉換為經緯度對
    data.elements.forEach(element => {
        if (element.type === "way" && element.nodes) {
            element.nodes.forEach(nodeId => {
                const node = data.elements.find(e => e.type === "node" && e.id === nodeId);
                if (node) {
                    coordinates.push([node.lat, node.lon]);
                }
            });
        }
    });

    return coordinates;
}

// 設置路線動畫
async function animateRoute() {
    const routeCoordinates = await fetchRouteData();  // 獲取國道一號的路徑座標
    const roadLine = L.polyline([], { color: 'blue', weight: 5 }).addTo(map);  // 初始化路線
    let i = 0;

    // 使用 setTimeout 控制每個點之間的繪製延遲
    function draw() {
        if (i < routeCoordinates.length) {
            roadLine.addLatLng(routeCoordinates[i]);  // 添加座標點
            i++;
            setTimeout(draw, 10);  // 每個點之間有 10 毫秒的延遲，可以根據需要調整
        }
    }

    draw();  // 開始畫路線動畫
}

// 開始顯示路線動畫
animateRoute();
</script>

</body>
</html>
